<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–í—ã–±–æ—Ä —á–µ–º–ø–∏–æ–Ω–∞</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(25, 25, 35, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.1);
      color: #e0e0e0;
    }

    h1 {
      text-align: center;
      color: #fff;
      margin-bottom: 25px;
      font-size: 2.5rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    #timer-container {
      text-align: center;
      margin-bottom: 20px;
    }

    #timer {
      font-size: 28px;
      font-weight: bold;
      color: #ff6b6b;
      padding: 15px 25px;
      background: rgba(255, 107, 107, 0.15);
      border-radius: 12px;
      display: inline-block;
      border: 2px solid rgba(255, 107, 107, 0.3);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }

    #current-turn {
      text-align: center;
      font-size: 18px;
      color: #ffd700;
      margin-bottom: 25px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .teams-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      gap: 30px;
    }

    .team-column {
      flex: 1;
      min-width: 220px;
      background: rgba(30, 30, 40, 0.7);
      padding: 20px;
      border-radius: 15px;
      border: 2px solid transparent;
    }

    .blue-team {
      border-color: rgba(79, 175, 255, 0.4);
      box-shadow: 0 0 15px rgba(79, 175, 255, 0.2);
    }

    .red-team {
      border-color: rgba(255, 107, 107, 0.4);
      box-shadow: 0 0 15px rgba(255, 107, 107, 0.2);
    }

    .team-title {
      font-weight: bold;
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.4rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .blue-team .team-title {
      color: #4facfe;
    }

    .red-team .team-title {
      color: #ff6b6b;
    }

    .bans-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 15px;
    }

    .ban-cell {
      width: 70px;
      height: 70px;
      border: 3px solid #444;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(40, 40, 50, 0.8);
      font-weight: bold;
      font-size: 11px;
      text-align: center;
      padding: 8px;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      transition: all 0.2s ease;
    }

    .blue-team .ban-cell {
      border-color: #4facfe;
      background: rgba(79, 175, 255, 0.15);
    }

    .red-team .ban-cell {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.15);
    }

    .main-game-area {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 25px;
      margin-bottom: 25px;
    }

    .picks-column {
      display: flex;
      flex-direction: column;
      gap: 15px;
      min-width: 110px;
    }

    .pick-cell {
      width: 90px;
      height: 90px;
      border: 3px solid #444;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(40, 40, 50, 0.8);
      font-weight: bold;
      font-size: 12px;
      text-align: center;
      padding: 8px;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      transition: all 0.2s ease;
    }

    .blue-picks-column .pick-cell {
      border-color: #4facfe;
      background: rgba(79, 175, 255, 0.2);
    }

    .red-picks-column .pick-cell {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.2);
    }

    /* Role selector styles */
    .role-selector {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .role-btn {
      padding: 8px 16px;
      background: rgba(50, 50, 60, 0.8);
      border: 2px solid #555;
      border-radius: 25px;
      color: #e0e0e0;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .role-btn:hover {
      background: rgba(79, 175, 255, 0.3);
      border-color: #4facfe;
      transform: translateY(-2px);
    }

    .role-btn.active {
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      color: #1a1a2e;
      border-color: #4facfe;
      box-shadow: 0 4px 15px rgba(79, 175, 255, 0.4);
    }

    #champions-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      flex: 1;
      min-width: 450px;
      background: rgba(35, 35, 45, 0.7);
      padding: 20px;
      border-radius: 15px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      max-height: 400px;
      overflow-y: auto;
    }

    .champion-cell {
      width: 90px;
      height: 90px;
      border: 3px solid #555;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(50, 50, 60, 0.9);
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 12px;
      text-align: center;
      padding: 8px;
      color: #e0e0e0;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .champion-cell:hover {
      transform: translateY(-3px);
      border-color: #888;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .champion-cell.selected {
      border-color: #00c9ff;
      background: rgba(0, 201, 255, 0.25);
      transform: scale(1.1) translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 201, 255, 0.4);
      color: #ffffff;
    }

    .buttons-container {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 25px;
    }

    .btn {
      padding: 14px 32px;
      font-size: 18px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: bold;
      letter-spacing: 1px;
      text-transform: uppercase;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    #confirm-btn {
      background: linear-gradient(45deg, #00c9ff, #92fe9d);
      color: #1a1a2e;
    }

    #confirm-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 201, 255, 0.5);
    }

    #ban-btn {
      background: linear-gradient(45deg, #ff6b6b, #ff8e53);
      color: white;
    }

    #ban-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
    }

    #result {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
      color: #4caf50;
      text-align: center;
      min-height: 28px;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .time-expired {
      background: rgba(255, 107, 107, 0.25) !important;
      color: #ff1744 !important;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 23, 68, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(255, 23, 68, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 23, 68, 0); }
    }

    .your-turn {
      color: #4caf50;
      font-style: italic;
      animation: glow 2s infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 5px #4caf50; }
      to { text-shadow: 0 0 20px #4caf50, 0 0 30px #4caf50; }
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(30, 30, 40, 0.5);
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      border-radius: 4px;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .teams-container {
        flex-direction: column;
        gap: 20px;
      }
      
      .main-game-area {
        flex-direction: column;
        gap: 20px;
      }
      
      .picks-column {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        min-width: auto;
      }
      
      .pick-cell {
        width: 70px;
        height: 70px;
        font-size: 10px;
      }
      
      .champion-cell {
        width: 70px;
        height: 70px;
        font-size: 10px;
      }
      
      .role-btn {
        padding: 6px 12px;
        font-size: 12px;
      }
      
      #champions-container {
        min-width: auto;
        max-height: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fas fa-crown"></i> –í—ã–±–æ—Ä —á–µ–º–ø–∏–æ–Ω–∞</h1>
    
    <div id="timer-container">
      <div id="timer">–í—Ä–µ–º—è: 30 —Å–µ–∫—É–Ω–¥</div>
    </div>
    
    <div id="current-turn">–¢–µ–∫—É—â–∏–π —Ö–æ–¥: –æ–∂–∏–¥–∞–Ω–∏–µ...</div>
    
    <div class="teams-container">
      <div class="team-column blue-team">
        <div class="team-title"><i class="fas fa-shield-alt"></i> –°–∏–Ω–∏–µ</div>
        <div class="bans-list" id="blue-bans"></div>
      </div>
      
      <div class="team-column red-team">
        <div class="team-title"><i class="fas fa-fire"></i> –ö—Ä–∞—Å–Ω—ã–µ</div>
        <div class="bans-list" id="red-bans"></div>
      </div>
    </div>

    <!-- Role Selector -->
    <div class="role-selector">
      <div class="role-btn active" data-role="all">–í—Å–µ</div>
      <div class="role-btn" data-role="top">–¢–æ–ø</div>
      <div class="role-btn" data-role="jungle">–õ–µ—Å</div>
      <div class="role-btn" data-role="mid">–°—Ä–µ–¥–Ω—è—è</div>
      <div class="role-btn" data-role="adc">–ë–æ—Ç</div>
      <div class="role-btn" data-role="support">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
    </div>

    <div class="main-game-area">
      <div class="picks-column blue-picks-column" id="blue-picks"></div>
      
      <div id="champions-container">
        <!-- –Ø—á–µ–π–∫–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å—é–¥–∞ -->
      </div>
      
      <div class="picks-column red-picks-column" id="red-picks"></div>
    </div>

    <div class="buttons-container">
      <button id="confirm-btn" class="btn"><i class="fas fa-check-circle"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    </div>
    
    <div id="result"></div>
  </div>

  <script>
  // Champions organized by roles
  const championsByRole = {
    all: [
      "–ê–∫–∞–ª–∏", "–ê—Ç—Ä–∏–∫—Å", "–ì–∞–Ω–≥—Ä–µ–Ω", "–î–∞—Ä–∏—É—Å", "–§–∏–æ", "–ò—Ä–µ–ª–∏—è", "–Ø—Å—É–æ", "–†–µ–Ω–µ–∫—Ç–æ–Ω", "–®–µ–Ω", "–û—Ä–Ω–Ω",
      "–ö–∞–π'—Å–∞", "–≠–≤–µ–ª–∏–Ω", "–ù–æ–∫—Ç—é—Ä–Ω", "–†–∞–º–º—É—Å", "–®–∞—Ñ—Ñ", "–í–æ–ª–∏–±–∏—Ä", "–•–µ–∫–∞—Ä–∏–º", "–ó–∞–∫", "–õ–∏–ª–ª–∞", "–ö–∏–Ω–¥—Ä–µ–¥",
      "–ê–Ω–∏–≤–∏—è", "–ê–∑–∏—Ä", "–ö–∞—Å—Å–∏–æ–ø–µ—è", "–õ—é–∫—Å", "–ú–∞–ª—å—Ñ–∏—Ç", "–ú–æ—Ä–≥–∞–Ω–∞–Ω–∞", "–û—Ä–∏–∞–Ω–Ω–∞", "–°–∏–Ω–¥—Ä–∞", "–¢–∞–ª–∏—è", "–í–∏–∫—Ç–æ—Ä",
      "–ê—Ñ–µ–ª–∏–æ—Å", "–ê—à", "–ö—ç–π—Ç–ª–∏–Ω", "–î–∂–∏–Ω–∫—Å", "–ö–∞–π—Å–∞", "–õ—é—Å–∏–Ω", "–ú–∏—Å—Å –§–æ—Ä—Ç—É–Ω", "–°–∏–≤–∏—Ä", "–¢—Ä–∏—Å—Ç–∞–Ω–∞", "–í–∞—Ä—É—Å",
      "–ë–∞—Ä–¥", "–ë—Ä–∞—É–º", "–ñ–∞–Ω–Ω–∞", "–ö–∞—Ä–º–∞", "–õ–µ–æ–Ω–∞", "–õ—É–ª—É", "–ù–∞—Ñ–∏–ª–∏", "–ü–∞–π–∫", "–°–æ—Ä–∞–∫–∞", "–¢–∞–ª–∏—è"
    ],
    top: ["–ê–∫–∞–ª–∏", "–ê—Ç—Ä–∏–∫—Å", "–ì–∞–Ω–≥—Ä–µ–Ω", "–î–∞—Ä–∏—É—Å", "–§–∏–æ", "–ò—Ä–µ–ª–∏—è", "–Ø—Å—É–æ", "–†–µ–Ω–µ–∫—Ç–æ–Ω", "–®–µ–Ω", "–û—Ä–Ω–Ω"],
    jungle: ["–ö–∞–π'—Å–∞", "–≠–≤–µ–ª–∏–Ω", "–ù–æ–∫—Ç—é—Ä–Ω", "–†–∞–º–º—É—Å", "–®–∞—Ñ—Ñ", "–í–æ–ª–∏–±–∏—Ä", "–•–µ–∫–∞—Ä–∏–º", "–ó–∞–∫", "–õ–∏–ª–ª–∞", "–ö–∏–Ω–¥—Ä–µ–¥"],
    mid: ["–ê–Ω–∏–≤–∏—è", "–ê–∑–∏—Ä", "–ö–∞—Å—Å–∏–æ–ø–µ—è", "–õ—é–∫—Å", "–ú–∞–ª—å—Ñ–∏—Ç", "–ú–æ—Ä–≥–∞–Ω–∞–Ω–∞", "–û—Ä–∏–∞–Ω–Ω–∞", "–°–∏–Ω–¥—Ä–∞", "–¢–∞–ª–∏—è", "–í–∏–∫—Ç–æ—Ä"],
    adc: ["–ê—Ñ–µ–ª–∏–æ—Å", "–ê—à", "–ö—ç–π—Ç–ª–∏–Ω", "–î–∂–∏–Ω–∫—Å", "–ö–∞–π—Å–∞", "–õ—é—Å–∏–Ω", "–ú–∏—Å—Å –§–æ—Ä—Ç—É–Ω", "–°–∏–≤–∏—Ä", "–¢—Ä–∏—Å—Ç–∞–Ω–∞", "–í–∞—Ä—É—Å"],
    support: ["–ë–∞—Ä–¥", "–ë—Ä–∞—É–º", "–ñ–∞–Ω–Ω–∞", "–ö–∞—Ä–º–∞", "–õ–µ–æ–Ω–∞", "–õ—É–ª—É", "–ù–∞—Ñ–∏–ª–∏", "–ü–∞–π–∫", "–°–æ—Ä–∞–∫–∞", "–¢–∞–ª–∏—è"]
  };

  const roomID = window.location.pathname.split('/')[2];
  const container = document.getElementById("champions-container");
  const timerElement = document.getElementById("timer");
  const currentTurnElement = document.getElementById("current-turn");
  const blueBansElement = document.getElementById("blue-bans");
  const redBansElement = document.getElementById("red-bans");
  const bluePicksElement = document.getElementById("blue-picks");
  const redPicksElement = document.getElementById("red-picks");
  let selectedCell = null;
  let timeLeft = 30;
  let timerInterval = null;
  let currentTurn = null;
  let gameStatus = null;
  let blueBans = [];
  let redBans = [];
  let bluePicks = [];
  let redPicks = [];
  let currentRole = 'all';

  // Function to render champions based on selected role
  function renderChampions(role = 'all') {
    container.innerHTML = '';
    const champions = championsByRole[role] || championsByRole.all;
    
    champions.forEach(name => {
      const cell = document.createElement("div");
      cell.classList.add("champion-cell");
      cell.textContent = name;
      cell.addEventListener("click", () => {
        if (selectedCell) selectedCell.classList.remove("selected");
        cell.classList.add("selected");
        selectedCell = cell;
      });
      container.appendChild(cell);
    });
  }

  // Initial render
  renderChampions();

  // Role button functionality
  document.querySelectorAll('.role-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      currentRole = this.dataset.role;
      renderChampions(currentRole);
      // Clear selection when changing roles
      if (selectedCell) {
        selectedCell.classList.remove("selected");
        selectedCell = null;
      }
    });
  });

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  async function SendChoice(champName) {
    try {
      const userUID = localStorage.getItem('user_uid');
      if (!userUID) {
        document.getElementById("result").textContent = "–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω!";
        return;
      }

      // üîí –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ –∑–∞–±–∞–Ω–µ–Ω –ª–∏ –∏ –Ω–µ –≤—ã–±—Ä–∞–Ω –ª–∏ —É–∂–µ
      const allUsedChampions = [...blueBans, ...redBans, ...bluePicks, ...redPicks];
      if (allUsedChampions.includes(champName)) {
        document.getElementById("result").textContent = "–≠—Ç–æ—Ç —á–µ–º–ø–∏–æ–Ω —É–∂–µ –∑–∞–±–∞–Ω–µ–Ω –∏–ª–∏ –≤—ã–±—Ä–∞–Ω!";
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å —Ö–æ–¥
      if (currentTurn !== userUID) {
        document.getElementById("result").textContent = "–ù–µ –≤–∞—à —Ö–æ–¥!";
        return;
      }

      const response = await fetch(`/room/${roomID}/action/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({ 
          user_uid: userUID, 
          champName: champName 
        })
      });
      const data = await response.json();
      console.log("SendChoice response:", data);
      // –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å UI –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã–±–æ—Ä–∞:", error);
      document.getElementById("result").textContent = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ!";
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–Ω–æ–≤ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ)
  function renderBans(bansList, containerElement) {
    containerElement.innerHTML = '';
    if (bansList && bansList.length > 0) {
      bansList.forEach(ban => {
        const banCell = document.createElement("div");
        banCell.classList.add("ban-cell");
        banCell.textContent = ban;
        containerElement.appendChild(banCell);
      });
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–∏–∫–æ–≤ (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ –ø–æ –∫—Ä–∞—è–º)
  function renderPicks(picksList, containerElement) {
    containerElement.innerHTML = '';
    if (picksList && picksList.length > 0) {
      picksList.forEach(pick => {
        const pickCell = document.createElement("div");
        pickCell.classList.add("pick-cell");
        pickCell.textContent = pick;
        containerElement.appendChild(pickCell);
      });
    }
  }

  // üîÅ –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –æ–ø—Ä–æ—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  let updateInterval; // –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –î–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

  async function pollUpdates() {
    try {
      const response = await fetch(`/room/${roomID}/update/`);
      if (!response.ok) {
        let savedI = localStorage.getItem('i');
        console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:", response.status);
        
        if (i > 5) { clearInterval(updateInterval); localStorage.setItem('i', 0);}
        i++;
        localStorage.setItem('i', i);
        return;
      }
      const data = await response.json();
      console.log("–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);

      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
      updateTimer(data.time);

      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ö–æ–¥
      currentTurn = data.cur_Turn;
      gameStatus = data.status;
      const userUID = localStorage.getItem('user_uid');
      if (currentTurn === userUID) {
        currentTurnElement.textContent = "–í–∞—à —Ö–æ–¥!";
        currentTurnElement.className = "your-turn";
      } else {
        currentTurnElement.textContent = `–•–æ–¥ –∏–≥—Ä–æ–∫–∞: ${currentTurn || '–æ–∂–∏–¥–∞–Ω–∏–µ...'}`;
        currentTurnElement.className = "";
      }
      blueBans = data.blue_bans || [];
      redBans = data.red_bans || [];
      bluePicks = data.blue_piks || [];
      redPicks = data.red_picks || [];
      // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–Ω—ã –∏ –ø–∏–∫–∏
      renderBans(data.blue_bans, blueBansElement);
      renderBans(data.red_bans, redBansElement);
      renderPicks(data.blue_piks, bluePicksElement);
      renderPicks(data.red_picks, redPicksElement);

      // –ï—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Äî –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø—Ä–æ—Å
      if (gameStatus == 'end') {
        clearInterval(updateInterval); // –¢–µ–ø–µ—Ä—å updateInterval –¥–æ—Å—Ç—É–ø–µ–Ω
      }
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø—Ä–æ—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:", error);
      clearInterval(updateInterval);
    }
  }

  // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 500 –º—Å
  updateInterval = setInterval(pollUpdates, 500);

  // –¢–∞–π–º–µ—Ä –≤—ã–±–æ—Ä–∞ —á–µ–º–ø–∏–æ–Ω–∞
  function updateTimer(seconds) {
    if (seconds <= 0) {
      timerElement.textContent = "–í—Ä–µ–º—è –≤—ã—à–ª–æ!";
      timerElement.classList.add("time-expired");
    } else {
      const word = seconds === 1 ? "—Å–µ–∫—É–Ω–¥–∞" : (seconds < 5 ? "—Å–µ–∫—É–Ω–¥—ã" : "—Å–µ–∫—É–Ω–¥");
      timerElement.textContent = `–í—Ä–µ–º—è: ${seconds} ${word}`;
      timerElement.classList.remove("time-expired");
    }
  }

  // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞
  document.getElementById("confirm-btn").addEventListener("click", () => {
    const resultDiv = document.getElementById("result");
    const userUID = localStorage.getItem('user_uid');
    
    if (!userUID) {
      resultDiv.textContent = "–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω!";
      return;
    }
    
    if (selectedCell) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å —Ö–æ–¥
      if (currentTurn !== userUID) {
        resultDiv.textContent = "–ù–µ –≤–∞—à —Ö–æ–¥!";
        return;
      }
      
      resultDiv.textContent = `–í—ã–±—Ä–∞–Ω —á–µ–º–ø–∏–æ–Ω: ${selectedCell.textContent}`;
      SendChoice(selectedCell.textContent);
      // –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º
    } else {
      resultDiv.textContent = "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —á–µ–º–ø–∏–æ–Ω–∞!";
    }
  });
  </script>
</body>
</html>

